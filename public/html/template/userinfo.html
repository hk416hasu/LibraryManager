<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta content="width=device-width, initial-scale=1">
   <title>ä½ ç”µå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
   <link rel="stylesheet" type="text/css" href="./css/login.css">
   <link rel="stylesheet" href="./css/navigation.css">
   <style>
      body {
         font-family: Arial, sans-serif;
         margin: 0;
         padding: 0;
      }
      .user-info {
          border: 1px solid #ddd;
          padding: 10px;
          box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
          margin: 20px 50px 20px 50px;
      }
      .user-info h2 {
          font-size: 1.5em;
          margin-bottom: 10px;
      }
      .user-info p {
          margin: 5px 0;
      }
      .user-info span.field {
          font-weight: bold;
      }
   </style>
</head>

<body>

   <!-- header -->

   <h1 style="text-align: center"> æ¬¢è¿æŸ¥è¯¢ ç”¨æˆ·ä¿¡æ¯ï¼</h1>

   <div class="user-info">
      <h2>ç”¨æˆ·ä¿¡æ¯</h2>
      <p><span class="field">ç”¨æˆ·ID:</span> <span id="userinfo-user-id">åŠ è½½ä¸­...</span></p>
      <p><span class="field">ç”¨æˆ·å:</span> <span id="userinfo-username">åŠ è½½ä¸­...</span></p>
      <p><span class="field">ç”¨æˆ·æƒé™ç­‰çº§:</span> <span id="userinfo-authority-level">åŠ è½½ä¸­...</span></p>
      <p><span class="field">æ‰‹æœºå·:</span> <span id="userinfo-phone">åŠ è½½ä¸­...</span></p>
      <p><span class="field">Email:</span> <span id="userinfo-email">åŠ è½½ä¸­...</span></p>
      <p><span class="field">ä¿¡ä»»ä½:</span> <span id="userinfo-trust-status">åŠ è½½ä¸­...</span></p>
   </div>

   <script>
      // æƒé™ç¿»è¯‘æ˜ å°„
      const authorityMapping = {
         0: 'ç”¨æˆ·ç®¡ç†å‘˜',
         1: 'æ™®é€šç”¨æˆ·',
         2: 'é«˜çº§ç”¨æˆ·',
         3: 'æ•™å¸ˆ',
         4: 'é‡‡ç¼–éƒ¨ç®¡ç†å‘˜',
         5: 'æµé€šéƒ¨ç®¡ç†å‘˜', 
         6: 'ç³»ç»Ÿç»´æŠ¤å‘˜', 
      };

      async function fetchUserInfo() {
         try {
            const uID1 = localStorage.getItem('uID');
            const uID2 = localStorage.getItem('uID');
            // è·å–è‡ªèº«ç”¨æˆ·ä¿¡æ¯
            const response = await fetch('/api/login/userinfo', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
               },
               body: JSON.stringify({
                  uID1: uID1,
                  uID2: uID2,
               }),
            });

            // æ£€æŸ¥å“åº”æ˜¯å¦æˆåŠŸ
            if (response.ok) {
               const result = await response.json();
               console.log('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ:', result);
               return result
            } else {
               const result = await response.json();
               console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', result);
               alert(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥\u{1f623} ${result.message}`);
               // TODO: should throw error
               return {
                  phoneNumber: 'Error',
                  email: 'Error',
                  credit: false,
               };
            }
         } catch (error) {
            console.error('Error fetching user info:', error);
            return {
               phoneNumber: 'Error',
               email: 'Error',
               credit: false,
            };
         }
      }

      // åŠ è½½ç”¨æˆ·ä¿¡æ¯å¹¶æ›´æ–°é¡µé¢
      async function loadUserInfo() {
         try {
            const userInfo = await fetchUserInfo();

            console.log(userInfo);

            // æ›´æ–°é¡µé¢å†…å®¹
            document.getElementById('userinfo-user-id').textContent = localStorage.getItem('uID');
            document.getElementById('userinfo-username').textContent = localStorage.getItem('username');
            document.getElementById('userinfo-authority-level').textContent = authorityMapping[localStorage.getItem('authority_num')] || 'æœªçŸ¥';
            // TODO: should get real user-info from guanxin
            document.getElementById('userinfo-phone').textContent = userInfo.phoneNumber;
            document.getElementById('userinfo-email').textContent = userInfo.email;
            document.getElementById('userinfo-trust-status').textContent = userInfo.credit ? 'å·²ä¿¡ä»»ğŸ‰' : 'æœªä¿¡ä»»ğŸ˜¡';
         } catch (error) {
            console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
         }
      }

      // åˆå§‹åŒ–åŠ è½½
      loadUserInfo();
   </script>

</body>
</html>
