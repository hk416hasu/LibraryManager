<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta content="width=device-width, initial-scale=1">
   <title>ä½ ç”µå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
   <link rel="stylesheet" type="text/css" href="./css/login.css">
   <link rel="stylesheet" href="./css/navigation.css">
   <style>
      body {
         font-family: Arial, sans-serif;
         margin: 0;
         padding: 0;
         text-align: center;
      }
   </style>
<style>

.user_manage_box {
   width: 100%;
   max-width: 400px;
   margin: 50px auto 0;
}

.user-manage-input {
   width: 100%;
   max-width: 300px;
   padding: 10px;
   margin-bottom: 15px;
   border: 1px solid #ddd;
   border-radius: 4px;
}

#user-manage-button {
   padding: 10px 20px;
   width: 100%;
   max-width: 300px;
   background-color: #007bff;
   color: white;
   border: none;
   border-radius: 4px;
   cursor: pointer;
}

#user-manage-button:hover {
   background-color: #0056b3;
}

</style>
</head>

<body>

   <!-- header -->

   <div class="lib-search-container">

      <h1 style="text-align: center">ç”¨æˆ·ç®¡ç†</h1>

      <div class="user_manage_box">
         <input type="text" class="user-manage-input" id="input_whom_wait_to_update" placeholder="è¦æ”¹è°? (uID)">
         <input type="text" class="user-manage-input" id="input_authority_u_want" placeholder="è¦ä¿®æ”¹åˆ°ä»€ä¹ˆæƒé™?">
         <button id="user-manage-button">æ›´æ–°æƒé™</button>
      </div>

   </div>
   <script>
function validateForm() {
   const uID1 = document.getElementById('input_whom_wait_to_update').value;
   const authorityNum = document.getElementById('input_authority_u_want').value;

   let isValid = true;

   const uidRegex = /^[0-9]{8}$/;
   if (!uidRegex.test(uID1)) {
      isValid = false;
   }

   const authorityNumRegex = /^[0-9]+$/;
   if (!authorityNumRegex.test(authorityNum)) {
      isValid = false;
   }

   return isValid;
}

document.getElementById('user-manage-button').addEventListener('click', async () => {
   console.log('æŒ‰ä¸‹äº†æ›´æ–°æƒé™çš„æŒ‰é”®');

   if(!validateForm()) {
      alert('è¾“å…¥æœ‰é—®é¢˜ğŸ˜…');
      return;
   }

   const uID1 = document.getElementById('input_whom_wait_to_update').value;
   const uID2 = localStorage.getItem('uID'); // ç®¡ç†å‘˜uID
   const authorityNum = document.getElementById('input_authority_u_want').value;

   try {
      const res = await fetch('/api/login/updateAuthority', {
         method: 'POST',
         headers: {
            'Content-Type': 'application/json',
         },
         body: JSON.stringify({
            uID1: uID1,
            uID2: uID2,
            authorityNum: authorityNum,
         }),
      });

      if (response.ok) {
         const result = await response.json();
         console.log('éªŒæ”¶æˆåŠŸ:', result);
         alert(`éªŒæ”¶æˆåŠŸğŸ˜Š: ${result.message}`);
      } else {
         const result = await response.json();
         console.error('éªŒæ”¶å¤±è´¥:', result);
         alert(`éªŒæ”¶å¤±è´¥\u{1f623} ${result.message}`);
      }
   } catch (error) {
      console.error('æ›´æ–°æƒé™å‡ºé”™:', error);
      alert('æ›´æ–°æƒé™æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
   } finally {
      window.location.reload();
   }
});
   </script>

</body>
</html>
